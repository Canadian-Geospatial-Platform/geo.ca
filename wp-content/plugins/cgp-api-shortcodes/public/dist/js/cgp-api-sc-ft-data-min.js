function cgpApiInit(){document.querySelectorAll(".cgp-custom-api-results").forEach((a=>{cgpApiSetupResults(a)}))}function cgpApiSetupResults(a){let t=a.getAttribute("id"),e=a.getAttribute("data-lang"),i=a.querySelector(".sc-cgp-api-ft-data"),r=a.getAttribute("data-api-url"),l=a.getAttribute("data-app-url"),s=a.getAttribute("data-result-url"),n=a.getAttribute("data-search-url"),d=a.getAttribute("data-type"),o=a.getAttribute("data-theme"),c=`Most accessed ${d} data`,p="Most accessed foundation data",u=`Most accessed ${d} data (fr)`,g="Most accessed foundation data (fr)",f="View all data",m="View all data (fr)",h="View all data",v="View all data (fr)";null!==o&&(c=`Most accessed ${o} data`,p=`Most accessed ${o} foundation data`,u=`Most accessed ${o} data (fr)`,g=`Most accessed ${o} foundation data (fr)`,h=`View all ${o} data`,v=`View all ${o} data (fr)`),"featured"===d&&(null!==o?(f=`View all ${o} data`,m=`View all ${o} data (fr)`):(f=`View all ${d} data`,m=`View all ${d} data (fr)`)),"foundational"===d&&(f="View all foundation data",m="View all foundation data (fr)"),cgpApiGetData({itemid:t,lang:e,htmlwrap:i,apiurl:r,appurl:l,resulturl:s,searchurl:n,datatype:d,theme:o,layout:a.getAttribute("data-layout"),showpagination:parseInt(a.getAttribute("data-show-pagination")),numitemsperpage:parseInt(a.getAttribute("data-num-items-page")),maxitems:parseInt(a.getAttribute("data-max-items"))},{en:{leafletAtrribution:"© Her Majesty the Queen in Right of Canada, as represented by the Minister of Natural Resources",na:"N/A",nodata:"We're sorry, something went wrong, please refresh the page.",org:"Organisation: ",pub:"Published: ",sectiontitleft:c,sectiontitlefnd:p,showless:"Show Less",view:"View Record",viewalldata:f,viewallftdata:h,viewfnddata:"View foundation data",viewftdata:"View featured data",viewmore:"View More"},fr:{leafletAtrribution:"© Sa Majesté la Reine du Chef du Canada, représentée par le ministre des Ressources naturelles",na:"N/A",nodata:"Nous sommes désolés, quelque chose s'est mal passé. Veuillez rafraîchir la page",org:"Organisation : ",pub:"Publié  : ",sectiontitleft:u,sectiontitlefnd:g,showless:"Montrer moins",view:"Afficher l'enregistrement",viewalldata:m,viewallftdata:v,viewfnddata:"Ensembles de données de base",viewftdata:"Jeux de données en vedette",viewmore:"Voir plus"}})}function cgpApiGetData(a,t){fetch(a.apiurl).then((function(a){return a.json()})).then((function(e){let i=e.Items.slice(0,a.maxitems);cgpApiShowData(a,t,i)})).then((function(e){cgpApiMakeLeafletMap(a,t)})).catch((function(e){cgpApiGetDataError(a,t),console.warn(t[a.lang].nodata,e)}))}function cgpApiShowData(a,t,e){let i,r="",l="",s="",n="",d="",o="",c="",p="",u=1,g="",f=1,m="featured"===a.datatype?t[a.lang].sectiontitleft:t[a.lang].sectiontitlefnd,h=("featured"===a.datatype?t[a.lang].viewfnddata:t[a.lang].viewftdata,""),v="";if("featured"===a.datatype&&(h=null!==a.theme?`${a.appurl}?theme=${a.theme}&lang=${a.lang}`:`${a.appurl}?lang=${a.lang}`),"foundational"===a.datatype&&(h=null!==a.theme?`${a.appurl}?foundational=y&theme=${a.theme}&lang=${a.lang}`:`${a.appurl}?foundational=y&lang=${a.lang}`),v=null!==a.theme?`${a.appurl}?theme=${a.theme}&lang=${a.lang}`:`${a.appurl}?lang=${a.lang}`,"full"===a.layout){r+='<div class="sec-header">',r+=`<h2 class="header-title">${m}</h2>`,r+="</div>",r+='<div class="sec-results-nav">',r+='<ul class="list">',r+=`<li class="list-item"><a href="${h}" target="_blank">${t[a.lang].viewalldata} <i class="fas fa-caret-right" aria-hidden="true"></i></a></li>`,r+="</ul>",r+="</div>",r+='<div class="sec-results-content" aria-live="polite">',e.forEach((e=>{if(s=e.title,n=e.id,d=e.organisation,o=e.coordinates,c=e.keywords,p=c.split(", "),i=e.published,resUrl=`${a.resulturl}?id=${n}&lang=${a.lang}`,resDesc=e.description,resDescExcerpt=resDesc.replace(/^(.{240}[^\s]*).*/,"$1"),resDesc.length>240&&(resDescExcerpt+=" ..."),g="card data-card show",mapCSSID=`cgp-api-map-${a.datatype}-${f}`,1===a.showpagination&&f>a.numitemsperpage&&(g="card data-card hide"),r+=`<div class="${g}" data-page-group="${u}">`,r+='<div class="card-body">',r+='<div class="card-map-wrap">',r+=`<div class="card-leaflet-map-wrap"><div id="${mapCSSID}" data-map-id="${n}" data-map-coords="${o}" class="card-leaflet-map"></div></div>`,r+="</div>",r+='<div class="card-content-wrap">',r+=`<h3 class="card-title"><a href="${resUrl}" target="_blank">${s}</a></h3>`,p=p.filter((a=>a)),p=cgpRemoveArrayVals(p,"null"),p.length>0){r+=`<div class="card-keywords ${a.datatype}">`,r+='<ul class="list">';let e=1;for(keyword of p){let t=`${a.searchurl}?keyword=${encodeURIComponent(keyword.toLowerCase())}&lang=${a.lang}`;r+=e<=5?`<li class="list-item"><a href="${t}" target="_blank">${keyword}</a></li>`:`<li class="list-item hidden"><a href="${t}" target="_blank">${keyword}</a></li>`,e++}p.length>5&&(r+=`<li class="list-item"><button class="show-more">${t[a.lang].viewmore}</button></li>`),r+="</ul>",r+="</div>"}r+='<div class="card-meta">',r+=`<p class="card-meta-item card-meta-item-org"><strong>${t[a.lang].org}</strong>${d}</p>`,r+=`<p class="card-meta-item card-meta-item-pub-date"><strong>${t[a.lang].pub}</strong>${i}</p>`,r+="</div>",r+='<div class="card-text">',r+=`<p>${resDescExcerpt}</p>`,r+="</div>",r+='<div class="card-button">',r+=`<p><a href="${resUrl}" target="_blank" class="btn btn-sm" aria-label="${s}">${t[a.lang].view}<i class="fas fa-long-arrow-alt-right"></i></a></p>`,r+="</div>",r+="</div>",r+="</div>",r+="</div>",f%a.numitemsperpage==0&&u++,f++})),r+="</div>";let v=0;if(e.length>a.numitemsperpage&&(v=Math.floor(e.length/a.numitemsperpage)),v>1&&1===a.showpagination){let a=1;for(l+='<div class="sec-pagination">',l+=`<nav class="pagination-nav" aria-label="Pagination Navigation" data-current-page-group="page-group-${a}">`,l+='<ul class="pagination-list">';a<=v;)l+=1==a?`<li class="pagination-list-item"><button class="pagination-btn current" data-page-num="${a}" aria-label="Current Page - Page ${a}" aria-current="true" aria-disabled="true">${a}</button></li>`:`<li class="pagination-list-item"><button class="pagination-btn" data-page-num="${a}" aria-label="Goto Page ${a}" aria-current="false">${a}</button></li>`,a++;l+="</ul>",l+="</nav>",l+="</div>"}a.htmlwrap.innerHTML=r+l,paginationEl=a.htmlwrap.querySelector(".sec-pagination"),v>1&&1===a.showpagination&&cgpApiMakePagination(paginationEl),cgpApiToggleKeywords(t,a)}else"compact"===a.layout&&(r+='<div class="sec-results-content" aria-live="polite">',e.forEach((t=>{s=t.title,n=t.id,o=t.coordinates,resUrl=`${a.resulturl}?id=${n}&lang=${a.lang}`,g="card data-card",mapCSSID=`cgp-api-map-${a.datatype}-${f}`,r+=`<div class="${g}">`,r+='<div class="card-body">',r+='<div class="card-map-wrap">',r+='<div class="card-leaflet-map-wrap">',r+=`<div id="${mapCSSID}" data-map-id="${n}" data-map-coords="${o}" class="card-leaflet-map"></div>`,r+="</div>",r+="</div>",r+='<div class="card-content-wrap">',r+=`<h3 class="card-title"><a href="${resUrl}" target="_blank">${s}</a></h3>`,r+="</div>",r+="</div>",r+="</div>",f++})),r+="</div>",a.htmlwrap.innerHTML=r)}function cgpApiMakeLeafletMap(a,t){document.querySelectorAll(".card-leaflet-map").forEach((e=>{let i=e.getAttribute("id"),r=e.getAttribute("data-map-coords"),l=JSON.parse(r),s=(l.reverse(),[(l[0][2][1]+l[0][0][1])/2,(l[0][1][0]+l[0][0][0])/2]),n=40.7436654315252*Math.max(Math.abs(l[0][2][1]-l[0][0][1]),Math.abs(l[0][1][0]-l[0][0][0]))*11132/15,d=Math.max(Math.log2(36e5/n),1);if(i.includes(a.datatype)){var o=L.map(i).setView(s,d);L.tileLayer("https://geoappext.nrcan.gc.ca/arcgis/rest/services/BaseMaps/CBMT_CBCT_GEOM_3857/MapServer/WMTS/tile/1.0.0/BaseMaps_CBMT_CBCT_GEOM_3857/default/default028mm/{z}/{y}/{x}.jpg",{attribution:t[a.lang].leafletAtrribution}).addTo(o);var c=[{type:"Feature",properties:{id:i,tag:"geoViewGeoJSON"},geometry:{type:"Polygon",coordinates:l}}];L.geoJSON(c).addTo(o)}}))}function cgpApiMakePagination(a){a.addEventListener("click",(function(t){if(t.target.hasAttribute("data-page-num")){t.preventDefault();let e=t.target.getAttribute("data-page-num"),i=a.closest(".sc-cgp-api-ft-data").querySelectorAll(".card"),r=a.querySelectorAll(".pagination-btn");for(btn of r)label=btn.getAttribute("aria-label"),btn.setAttribute("aria-label",label.replace("Current Page - ","")),btn.setAttribute("aria-disabled",!1),btn.setAttribute("aria-current",!1),btn.classList.remove("current");t.target.setAttribute("aria-label","Current Page - Page "+e),t.target.setAttribute("aria-current",!0),t.target.setAttribute("aria-disabled",!0),t.target.classList.add("current");for(let a of i){let t=a.getAttribute("data-page-group");a.classList.remove("show"),a.classList.add("hide"),e==t&&(a.classList.remove("hide"),a.classList.add("show"))}}}))}function cgpApiGetDataError(a,t){let e="";e+='<div class="sc-cgp-api-ft-data-results sc-cgp-api-error">',e+=`<p>${t[a.lang].nodata}</p>`,e+="</div>",a.htmlwrap.innerHTML=e}function cgpApiToggleKeywords(a,t){var e=document.querySelectorAll(`.card-keywords.${t.datatype} .show-more`);for(const i of e)i.addEventListener("click",(function(e){console.log(i),i.textContent=i.firstChild.textContent===a[t.lang].viewmore?a[t.lang].showless:a[t.lang].viewmore;let r=i.parentElement.parentElement.querySelectorAll(".list-item");for(let a of r)a.classList.contains("hidden")?(a.classList.add("show"),a.classList.remove("hidden")):a.classList.contains("show")&&(a.classList.add("hidden"),a.classList.remove("show"))}))}function cgpApiUpdateResults(a,t,e){let i="",r=a.getAttribute("data-parent-id"),l=document.getElementById(r),s=l.getAttribute("data-loader-gif"),n="featured"===l.getAttribute("data-type")?"foundational":"featured",d=l.getAttribute("data-api-url"),o="featured"===l.getAttribute("data-type")?d.replace("featured","foundational"):d.replace("foundational","featured");l.setAttribute("data-type",n),l.setAttribute("data-api-url",o),i+='<div class="content-loader">',i+=`<img src="${s}" alt="Content loading" />`,i+="</div>",l.querySelector(".sc-cgp-api-ft-data").innerHTML=i,cgpApiSetupResults(l)}function cgpApiCapitalizeStr(a){return"string"!=typeof a?"":a.charAt(0).toUpperCase()+a.slice(1)}function cgpRemoveArrayVals(a){for(var t,e,i=arguments,r=i.length;r>1&&a.length;)for(t=i[--r];-1!==(e=a.indexOf(t));)a.splice(e,1);return a}cgpApiInit();
//# sourceMappingURL=cgp-api-sc-ft-data-min.js.map