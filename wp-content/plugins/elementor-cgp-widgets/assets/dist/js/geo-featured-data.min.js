class GeoFeaturedDataHandler extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{wrapper:".geo-featured-data",loader:".geo-featured-data__loader",results:".geo-featured-data__results"}}}getDefaultElements(){const e=this.getSettings("selectors");return{$wrapper:this.$element.find(e.wrapper),$loader:this.$element.find(e.loader),$results:this.$element.find(e.results)}}bindEvents(){this.elements.$results.on("click",".geo-featured-data-card__view-more-button",this.onViewMoreButtonClick.bind(this))}onViewMoreButtonClick(e){let t=jQuery(e.currentTarget);t.parent().find(".geo-featured-data-card__keyword").filter(e=>e>=5).toggleClass("hidden"),t.hasClass("clicked")?t.html(this.labels[this.lang].viewMore).removeClass("clicked"):t.html(this.labels[this.lang].showLess).addClass("clicked")}onInit(){super.onInit(),this.theme=this.elements.$wrapper.data("theme"),this.lang=this.elements.$wrapper.data("lang"),this.type=this.elements.$wrapper.data("type"),this.maxItems=this.elements.$wrapper.data("max-items"),this.labels={en:{keywordsTitle:"Related Topics",leafletAttribution:"© Her Majesty the Queen in Right of Canada, as represented by the Minister of Natural Resources",errorMessage:"We're sorry, something went wrong, please refresh the page.",organization:"Organization:",published:"Published:",showLess:"Show Less",viewMore:"View More",viewRecord:"View Record"},fr:{keywordsTitle:"Sujets connexes",leafletAttribution:"© Sa Majesté la Reine du Chef du Canada, représentée par le ministre des Ressources naturelles",errorMessage:"Nous sommes désolés, quelque chose s'est mal passé. Veuillez rafraîchir la page",organization:"Organisation :",published:"Publié :",showLess:"Montrer moins",viewMore:"Voir plus",viewRecord:"Afficher l'enregistrement"}},this.fetchFeaturedData()}fetchFeaturedData(){let e=geo.geocoreApiUrl;e+="/"+this.type+"?lang="+this.lang,this.theme&&(e+="&theme="+this.theme),fetch(e).then(e=>e.json()).then(e=>{let t=e.Items;t=t.slice(0,this.maxItems),this.elements.$loader.hide(),t.length&&t.forEach(e=>{this.renderRecord(e),this.initializeLeaftletMap(e)})}).catch(e=>{this.elements.$loader.hide(),this.renderErrorMessage(),console.warn(this.labels[this.lang].errorMessage,e)})}renderRecord(e){let t=geo.appUrl+"/result?id="+e.id+"&lang="+this.lang,a=this.getKeywordsHtml(e.keywords),s=e.description.replaceAll("\\n\\n"," "),r=`\n\t\t\t<div class="geo-featured-data-card">\n\t\t\t\t<div class="geo-featured-data-card__map">\n\t\t\t\t\t<div class="geo-featured-data-card__map-inner">\n\t\t\t\t\t\t<div id="map-${e.id}" class="geo-featured-data-card__leaftlet-map"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="geo-featured-data-card__content">\n\t\t\t\t\t<h3 class="geo-featured-data-card__title">\n\t\t\t\t\t\t<a href="${t}">${e.title}</a>\n\t\t\t\t\t</h3>\n\t\t\t\t\t<div class="geo-featured-data-card__keywords">\n\t\t\t\t\t\t<h4 class="screen-reader-text">${this.labels[this.lang].keywordsTitle}</h4>\n\t\t\t\t\t\t${a}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="geo-featured-data-card__organization">\n\t\t\t\t\t\t<strong>${this.labels[this.lang].organization}</strong> ${e.organisation}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="geo-featured-data-card__published-date">\n\t\t\t\t\t\t<strong>${this.labels[this.lang].published}</strong> ${e.published}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="geo-featured-data-card__description"><p>${s}</p></div>\n\t\t\t\t\t<div class="geo-featured-data-card__view-record">\n\t\t\t\t\t\t <a class="elementor-button elementor-size-sm" href="${t}">${this.labels[this.lang].viewRecord}</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;this.elements.$results.append(r)}getKeywordsHtml(e){let t="",a=1,s=geo.appUrl+"?lang="+this.lang+"&keyword=",r=e.split(",").map(e=>e.trim()).filter(e=>"null"!=e);if(r.forEach(e=>{let r=s+encodeURIComponent(e.toLowerCase()),i="";a>5&&(i="hidden"),t+=`<a class="geo-featured-data-card__keyword ${i}" href="${r}">${e}</a>`,a++}),r.length>5){let e=this.labels[this.lang].viewMore;t+=`<button class="geo-featured-data-card__view-more-button">${e}</button>`}return t}initializeLeaftletMap(e){let t="map-"+e.id,a=JSON.parse(e.coordinates),s=[(a[0][2][1]+a[0][0][1])/2,(a[0][1][0]+a[0][0][0])/2],r=0,i=40.7436654315252*Math.max(Math.abs(a[0][2][1]-a[0][0][1]),Math.abs(a[0][1][0]-a[0][0][0]))*11132/15;r=Math.max(Math.log2(36e5/i),1);let l=L.map(t).setView(s,r);L.tileLayer("https://geoappext.nrcan.gc.ca/arcgis/rest/services/BaseMaps/CBMT_CBCT_GEOM_3857/MapServer/WMTS/tile/1.0.0/BaseMaps_CBMT_CBCT_GEOM_3857/default/default028mm/{z}/{y}/{x}.jpg",{attribution:this.labels[this.lang].leafletAttribution}).addTo(l);let n=[{type:"Feature",properties:{id:t,tag:"geoViewGeoJSON"},geometry:{type:"Polygon",coordinates:a}}];L.geoJSON(n).addTo(l)}renderErrorMessage(){let e=`<div class="geo-featured-data-card__error-message">${this.labels[this.lang].errorMessage}</div>`;this.elements.$results.append(e)}}jQuery(window).on("elementor/frontend/init",e=>{elementorFrontend.elementsHandler.attachHandler("geo-featured-data",GeoFeaturedDataHandler)});